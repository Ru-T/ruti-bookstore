<div class="container">
  <h1> My Shopping Cart </h1>

  <% @pending_purchases.each do |purchase| %>
    <p> <%= purchase.user.email %> </p>
    <p> <%= purchase.book.title %> </p>
    <p> <%= purchase.quantity %>
        <%= link_to 'Edit Quantity', edit_pending_purchase_path(purchase), id: "edit_quantity" %>
    </p>
    <p> <%= purchase.price_at_purchase %> </p>
    <%= form_for(current_user.pending_purchases.find_by_book_id(purchase.book.id),
                 method: :delete) do |f| %>
      <%= f.submit "Remove from Cart" %>
    <% end %>
    <%= form_tag charges_path do %>
      <article>
        <% if flash[:error].present? %>
          <div id="error_explanation">
            <p><%= flash[:error] %></p>
          </div>
        <% end %>
        <%= hidden_field_tag :pending_purchase_id, purchase.id %>
        <label class="amount">
          <span>Amount: <%= purchase.price_at_purchase * 100 %></span>
        </label>
      </article>

      <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
              data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
              data-description="Your Books"
              data-billing-address=true
              data-shipping-address=true
              data-amount="500"
              data-label="Purchase"
              data-panel-label="Submit Order"
              data-locale="auto"></script>
    <% end %>
  <% end %>
</div>
